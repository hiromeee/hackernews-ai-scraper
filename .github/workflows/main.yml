name: Fetch AI News

# ワークフローが実行されるタイミング
on:
  # 1. スケジュール実行 (Cronジョブ)
  # 16時間ごとに実行 (UTC基準)
  schedule:
    - cron: "0 */16 * * *"
  
  # 2. 手動実行 (Actionsタブから)
  # GitHubのActionsタブで "Run workflow" ボタンを押して手動実行できる
  workflow_dispatch:

jobs:
  scrape-news:
    # 実行環境 (最新のUbuntu)
    runs-on: ubuntu-latest

    steps:
      # 1. リポジトリのコードをチェックアウト
      - name: Check out repository
        uses: actions/checkout@v4

      # 2. Python環境のセットアップ (バージョン 3.10)
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.10"
          cache: "pip" # pipのキャッシュを有効化

      # 3. 必要なライブラリをインストール
      - name: Install dependencies
        run: pip install -r requirements.txt

      # 4. Pythonスクリプトを実行
      - name: Run scraper
        run: python scrape_hackernews.py

      # 5. (重要) 変更を自動コミット
      # scrape_hackernews.py が ai_news.json を更新した場合、
      # 変更を検知して自動でコミット＆プッシュする
      - name: Commit and push if changed
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          # コミットメッセージ
          commit_message: "Update AI news"
          # コミット対象のファイル (ai_news.json のみ)
          file_pattern: ai_news.json
          # コミットするユーザー名
          commit_user_name: "GitHub Actions Bot"
          # コミットするユーザーのEmail
          commit_user_email: "actions@github.com"